<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    <link rel="stylesheet" href="style.css" />
    <title>Forecast</title>
  </head>
  <body>
      <div class="mt-4">
        <div class="card p-2 m-auto" style="width: 1500px !important;">
          <div class="mt-3">
            <h3>5 - Days Forecast</h3>
          </div>

          <div class="row mt-5 mx-5 " style="background-color: #87aaa2;border-radius: 30px;min-height: 50px;">
            <div class="col d-flex justify-content-center" style="font-size:50px;">
                Hari
            </div>

            <div class="col d-flex justify-content-center" style="font-size:50px;">
                Kelembapan
            </div>

            <div class="col d-flex justify-content-center">
                Temperatur
            </div>

            <div class="col d-flex justify-content-center">
                Awan
            </div>
        </div>
          <div id="kartu-container" class="mt-3"></div>
        </div>
      </div>      
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  </body>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const city = urlParams.get("city");
    const key = "2ee1f50b42f9a9574aa53907971c6b27";
    const url = "http://api.openweathermap.org/data/2.5/forecast?&units=metric&q=";
    

    window.onload = function () {
      forecast();
      console.log('its works');
    };
    async function forecast() {
      try {
        var weekDays = getWeekDays("id-ID");
        const response = await fetch(url + city + `&appid=${key}`);
        var data = await response.json();

        // tempat menampung Kartu
        var cardsContainer =  document.getElementById("kartu-container");

        // Loop untuk setiap item dalam array cardData
        for (var i = 0; i < 5; i++) {
            var icon = data.list[i].weather[0].icon + ".png";
            var url_icon = `https://openweathermap.org/img/wn/${icon}`;
            var url_alt = data.list[i].weather[0].description;
            // Membuat elemen div baru untuk setiap kartu
            var card = document.createElement("div");            

            // Mengisi kartu dengan data
            card.innerHTML = `
            <div class="row m-5 " style="background-color: #87aaa2;border-radius: 30px;min-height: 50px;">
                <div class="col d-flex justify-content-center" style="font-size:25px;">
                    <center>${weekDays[i]}</center>
                </div>

                <div class="col d-flex justify-content-center" style="font-size:25px;">
                    ${data.list[i].main.humidity + "%"}
                </div>

                <div class="col d-flex justify-content-center" style="font-size:25px;">
                    ${data.list[i].main.temp + "°C" + ` <img src="${url_icon}" alt="${url_alt}" >`}
                </div>

                <div class="col d-flex justify-content-center" style="font-size:25px;">
                    ${data.list[i].clouds.all + "%" ?? 0}
                </div>
            </div>
            
            `;

            // Menambahkan kartu ke dalam kontainer
            cardsContainer.appendChild(card);
        }
        //   alert(data.list[0] ?? "Data Not Found");
        //   console.log(data.list[0] ?? "Data Not Found");
        // var tbody = document.getElementById("table_forecast").getElementsByTagName("tbody")[0];
        // for (var i = 0; i < 5; i++) {
        //     var icon = data.list[i].weather[0].icon + ".png";
        //     var url_icon = `https://openweathermap.org/img/wn/${icon}`;
        //     var url_alt = data.list[i].weather[0].description;
        //   // Membuat baris baru
        //   var row = tbody.insertRow(i);

        //   // Mengisi sel-sel baris dengan data
        //   var cell1 = row.insertCell(0);
          
        //   cell1.innerHTML = weekDays[i];

        //   var cell2 = row.insertCell(1);
        //   cell2.innerHTML = data.list[i].main.humidity + "%";

        //   var cell3 = row.insertCell(2);
        //   cell3.innerHTML = data.list[i].main.temp + "°C" + ` <img src="${url_icon}" alt="${url_alt}" >`;

        //   var cell4 = row.insertCell(3);
        //   cell4.innerHTML = data.list[i].clouds.all + "%" ?? 0;
        // }
      } catch (error) {
        console.log(error);
        alert("Terjadi Kesalahan");
      }
    }

    // mengambil nama Hari Dalam Bahasa indo
    // ref: https://stackoverflow.com/questions/24998624/day-name-from-date-in-js
    function getWeekDays(locale) {
      var baseDate = new Date(Date.now()); // just a Monday
      var weekDays = [];
      for (i = 0; i < 7; i++) {
        weekDays.push(baseDate.toLocaleDateString(locale, { weekday: "long" }));
        baseDate.setDate(baseDate.getDate() + 1);
      }
      return weekDays;
    }
  </script>
</html>
